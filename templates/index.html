{% extends "layout.html" %}

{% block title %}Home - Rumah Kebaikan{% endblock %}

{% block content %} 

<header class="hero-slideshow">
    <div class="slideshow-container">
        <div class="slide-track">
            <div class="slide" style="background-image: url('/static/donasi1.jpg');"></div>
            <div class="slide" style="background-image: url('/static/donasi2.jpg');"></div>
            <div class="slide" style="background-image: url('/static/donasi3.jpg');"></div>
            <div class="slide" style="background-image: url('/static/bencana1.jpg');"></div>
            <div class="slide" style="background-image: url('/static/bencana2.jpg');"></div>
            <!-- Duplicate for seamless loop -->
            <div class="slide" style="background-image: url('/static/donasi1.jpg');"></div>
            <div class="slide" style="background-image: url('/static/donasi2.jpg');"></div>
        </div>
        <div class="hero-overlay"></div>
    </div>
    <div class="hero-content">
        <div class="container">
            <div class="row align-items-center min-vh-50">
                <div class="col-12 text-center">
                    <h1 class="display-4 fw-bold text-white">Selamat Datang di Rumah Kebaikan</h1>
                    <p class="lead mt-3 text-white">Dari Rumah untuk Banyak Kebaikan</p>
                    <p class="mt-3 text-white">Platform donasi online terpercaya untuk membantu sesama yang membutuhkan. Bersama kita wujudkan kebaikan untuk Indonesia.</p>
                    <div class="mt-4">
                        <a href="{{ url_for('campaigns') }}" class="btn btn-light btn-lg me-2">
                            <i class="bi bi-megaphone me-2"></i>Lihat Campaign
                        </a>
                        {% if not session.user_id %}
                        <a href="{{ url_for('register') }}" class="btn btn-outline-light btn-lg">
                            <i class="bi bi-person-plus me-2"></i>Daftar Sekarang
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Statistics Section -->
{% if campaigns %}
<section class="py-5 mt-4 bg-light">
    <div class="container">
        <div class="row g-4 text-center">
            <div class="col-md-4">
                <div class="card h-100 shadow-sm border-0 stat-card">
                    <div class="card-body py-4">
                        <div class="stat-icon mb-3">
                            <i class="bi bi-megaphone display-5 text-primary-teal"></i>
                        </div>
                        <h3 class="text-primary-teal fw-bold mb-2">{{ campaigns|length }}</h3>
                        <p class="text-muted mb-0">Campaign Aktif</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100 shadow-sm border-0 stat-card">
                    <div class="card-body py-4">
                        <div class="stat-icon mb-3">
                            <i class="bi bi-cash-stack display-5 text-primary-teal"></i>
                        </div>
                        <h3 class="text-primary-teal fw-bold mb-2">Rp {{ "{:,.0f}".format(campaigns|sum(attribute='terkumpul')) }}</h3>
                        <p class="text-muted mb-0">Total Terkumpul</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100 shadow-sm border-0 stat-card">
                    <div class="card-body py-4">
                        <div class="stat-icon mb-3">
                            <i class="bi bi-bullseye display-5 text-primary-teal"></i>
                        </div>
                        <h3 class="text-primary-teal fw-bold mb-2">Rp {{ "{:,.0f}".format(campaigns|sum(attribute='kebutuhan')) }}</h3>
                        <p class="text-muted mb-0">Total Target</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Campaign yang sedang berjalan -->
<section class="py-5">
    <div class="container">
        <div class="row mb-4">
            <div class="col-md-12 text-center">
                <h2 class="fw-bold">Campaign Hari Ini</h2>
                <p class="text-muted">Bantu mereka yang membutuhkan</p>
            </div>
        </div>

        {% if campaigns %}
            {% if campaigns|length > 3 %}
            <!-- Ketika campaign lebih dari 3 -->
            <div class="campaign-slider-wrapper">
                <div class="campaign-slider" id="campaignSlider">
                    {% for campaign in campaigns[:6] %}
                    <div class="campaign-slide">
                        <div class="card h-100 shadow-sm border-0 campaign-card">
                            <div class="card-body">
                                <h5 class="card-title fw-bold">{{ campaign.nama }}</h5>
                                <p class="card-text text-muted small"><i class="bi bi-geo-alt me-1"></i>{{ campaign.alamat }}</p>
                                <p class="card-text">{{ campaign.deskripsi[:100] }}{% if campaign.deskripsi|length > 100 %}...{% endif %}</p>
                                
                                <div class="progress mb-2" style="height: 8px;">
                                    {% set progress = (campaign.terkumpul / campaign.kebutuhan * 100) if campaign.kebutuhan > 0 else 0 %}
                                    <div class="progress-bar bg-primary-teal" role="progressbar" style="width: {{ progress }}%"></div>
                                </div>
                                
                                <div class="d-flex justify-content-between small mb-3">
                                    <span class="text-black fw-bold">Rp {{ "{:,.0f}".format(campaign.terkumpul) }}</span>
                                    <span class="text-muted">dari Rp {{ "{:,.0f}".format(campaign.kebutuhan) }}</span>
                                </div>
                                
                                <a href="{{ url_for('campaign_detail', campaign_id=campaign.id) }}" class="btn btn-primary-teal btn-sm w-100">
                                    <i class="bi bi-cash-stack me-1"></i>Donasi Sekarang
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="campaign-slider-controls">
                    <button class="btn btn-outline-primary-teal" id="sliderPrev">
                        <i class="bi bi-chevron-left"></i>
                    </button>
                    <button class="btn btn-outline-primary-teal" id="sliderNext">
                        <i class="bi bi-chevron-right"></i>
                    </button>
                </div>
            </div>
            
            <script>
            document.addEventListener('DOMContentLoaded', function() {
                const slider = document.getElementById('campaignSlider');
                const prevBtn = document.getElementById('sliderPrev');
                const nextBtn = document.getElementById('sliderNext');
                
                if (!slider || !prevBtn || !nextBtn) return;
                
                let currentIndex = 0;
                const slides = slider.querySelectorAll('.campaign-slide');
                const totalSlides = slides.length;
                
                function getVisibleSlides() {
                    if (window.innerWidth < 576) return 1;
                    if (window.innerWidth < 992) return 2;
                    return 3;
                }
                
                function updateSlider() {
                    const visibleSlides = getVisibleSlides();
                    const maxIndex = Math.max(0, totalSlides - visibleSlides);
                    if (currentIndex > maxIndex) currentIndex = maxIndex;
                    
                    const slideWidth = 100 / visibleSlides;
                    slider.style.transform = `translateX(-${currentIndex * slideWidth}%)`;
                }
                
                prevBtn.addEventListener('click', function() {
                    if (currentIndex > 0) {
                        currentIndex--;
                        updateSlider();
                    }
                });
                
                nextBtn.addEventListener('click', function() {
                    const visibleSlides = getVisibleSlides();
                    const maxIndex = totalSlides - visibleSlides;
                    if (currentIndex < maxIndex) {
                        currentIndex++;
                        updateSlider();
                    }
                });
                
                window.addEventListener('resize', updateSlider);
                updateSlider();
            });
            </script>
            {% else %}
            <!-- Regular grid for 3 or fewer campaigns -->
            <div class="row g-4">
                {% for campaign in campaigns[:6] %}
                <div class="col-md-4">
                    <div class="card h-100 shadow-sm border-0 campaign-card">
                        <div class="card-body">
                            <h5 class="card-title fw-bold">{{ campaign.nama }}</h5>
                            <p class="card-text text-muted small"><i class="bi bi-geo-alt me-1"></i>{{ campaign.alamat }}</p>
                            <p class="card-text">{{ campaign.deskripsi[:100] }}{% if campaign.deskripsi|length > 100 %}...{% endif %}</p>
                            
                            <div class="progress mb-2" style="height: 8px;">
                                {% set progress = (campaign.terkumpul / campaign.kebutuhan * 100) if campaign.kebutuhan > 0 else 0 %}
                                <div class="progress-bar bg-primary-teal" role="progressbar" style="width: {{ progress }}%"></div>
                            </div>
                            
                            <div class="d-flex justify-content-between small mb-3">
                                <span class="text-black fw-bold">Rp {{ "{:,.0f}".format(campaign.terkumpul) }}</span>
                                <span class="text-muted">dari Rp {{ "{:,.0f}".format(campaign.kebutuhan) }}</span>
                            </div>
                            
                            <a href="{{ url_for('campaign_detail', campaign_id=campaign.id) }}" class="btn btn-primary-teal btn-sm w-100">
                                <i class="bi bi-cash-stack me-1"></i>Donasi Sekarang
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        {% else %}
            <div class="col-12 text-center">
                <p class="text-muted">Belum ada campaign aktif saat ini.</p>
            </div>
        {% endif %}
        
        {% if campaigns and campaigns|length > 6 %}
        <div class="text-center mt-4">
            <a href="{{ url_for('campaigns') }}" class="btn btn-outline-primary-teal">Lihat Semua Campaign</a>
        </div>
        {% endif %}
    </div>
</section>

<!-- Program Kami -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row mb-5">
            <div class="col-md-12 text-center">
                <h2 class="fw-bold">Program Kami</h2>
                <p class="text-muted">Berbagai program kebaikan untuk membantu sesama</p>
            </div>
        </div>

        <div class="row g-4">
            <div class="col-md-3">
                <div class="card h-100 shadow-sm border-0 text-center">
                    <div class="card-body">
                        <div class="mb-3">
                            <i class="bi bi-book display-4 text-primary-teal"></i>
                        </div>
                        <h5 class="card-title fw-bold">Pendidikan</h5>
                        <p class="card-text text-muted">Beasiswa dan bantuan pendidikan untuk anak-anak kurang mampu.</p>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card h-100 shadow-sm border-0 text-center">
                    <div class="card-body">
                        <div class="mb-3">
                            <i class="bi bi-hospital display-4 text-primary-teal"></i>
                        </div>
                        <h5 class="card-title fw-bold">Kesehatan</h5>
                        <p class="card-text text-muted">Bantuan biaya pengobatan dan kesehatan untuk yang membutuhkan.</p>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card h-100 shadow-sm border-0 text-center">
                    <div class="card-body">
                        <div class="mb-3">
                            <i class="bi bi-people display-4 text-primary-teal"></i>
                        </div>
                        <h5 class="card-title fw-bold">Sosial & Kemanusiaan</h5>
                        <p class="card-text text-muted">Program bantuan sosial dan kemanusiaan untuk masyarakat.</p>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card h-100 shadow-sm border-0 text-center">
                    <div class="card-body">
                        <div class="mb-3">
                            <i class="bi bi-cloud-rain display-4 text-primary-teal"></i>
                        </div>
                        <h5 class="card-title fw-bold">Bencana Alam</h5>
                        <p class="card-text text-muted">Tanggap darurat dan pemulihan korban bencana alam.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Tentang Kami -->
<section class="py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-6 order-md-1">
                <img src="{{ url_for('static', filename='flyer_rk.png') }}" alt="flyer_rk.png" class="img-fluid" width="400" height="400">
            </div>
            <div class="col-md-6 order-md-2">
                <h2 class="fw-bold mb-4">Tentang Rumah Kebaikan</h2>
                <p class="text-muted">Rumah Kebaikan adalah platform donasi online yang menghubungkan para dermawan dengan berbagai program kebaikan di seluruh Indonesia.</p>
                <p class="text-muted">Kami berkomitmen untuk transparansi dan akuntabilitas dalam setiap donasi yang diterima, memastikan bantuan Anda sampai kepada yang membutuhkan.</p>
                <ul class="list-unstyled">
                    <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>100% Donasi tersalurkan</li>
                    <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>Transparan dan akuntabel</li>
                    <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>Laporan donasi real-time</li>
                </ul>
            </div>
        </div>
    </div>
</section>
{% endblock %}